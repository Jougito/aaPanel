System.register(["./page_layout-legacy.js?v=1760428868419","./index-legacy133.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy12.js?v=1760428868419","./naive-legacy.js?v=1760428868419","./vue-legacy.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy8.js?v=1760428868419","./index-legacy131.js?v=1760428868419","./public-legacy.js?v=1760428868419","./site-legacy.js?v=1760428868419","./soft-legacy2.js?v=1760428868419","./php-legacy.js?v=1760428868419","./useOperate-legacy.js?v=1760428868419","./common-legacy.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy15.js?v=1760428868419","./index-legacy.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1760428868419"],function(e,t){"use strict";var a,l,i,n,s,o,r,u,d,c,p,m,f,y,v,g,h,_,x,w,k,b,S,P,C,H,j,B,$,M,U,W,T,N,L,R,V,D,A,O,q,I,K,F,z,E,Q,G,X,Y,Z,J,ee,te,ae,le,ie,ne,se,oe,re,ue,de,ce,pe,me,fe,ye,ve,ge,he,_e,xe,we,ke,be,Se,Pe,Ce,He,je,Be,$e,Me,Ue,We,Te,Ne,Le,Re,Ve,De,Ae,Oe,qe,Ie,Ke,Fe,ze,Ee,Qe,Ge,Xe,Ye,Ze,Je,et,tt,at,lt,it,nt,st;return{setters:[e=>{a=e.j,l=e.s,i=e.bf,n=e.ar,s=e.dk,o=e.d,r=e.a,u=e.z,d=e.p,c=e.q,p=e.r,m=e.a5,f=e._,y=e.u,v=e.w,g=e.a8,h=e.m,_=e.o},e=>{x=e._},e=>{w=e._},e=>{k=e._},e=>{b=e._},e=>{S=e.de,P=e.di,C=e.aC,H=e._,j=e.d5,B=e.dc,$=e.dd,M=e.d8,U=e.dh,W=e.aX,T=e.da,N=e.bH,L=e.dj,R=e.dm,V=e.au,D=e.dg,A=e.dR,O=e.dV,q=e.dS},e=>{I=e.k,K=e.i,F=e.r,z=e.o,E=e.w,Q=e.a2,G=e.V,X=e.U,Y=e.a3,Z=e.W,J=e.S,ee=e.F,te=e.Z,ae=e.c,le=e.P,ie=e._,ne=e.a0,se=e.R,oe=e.H,re=e.a4,ue=e.l,de=e.v,ce=e.j,pe=e.am,me=e.av,fe=e.ak,ye=e.O,ve=e.x,ge=e.s,he=e.e,_e=e.N,xe=e.ah,we=e.an,ke=e.p},e=>{be=e._},e=>{Se=e._},e=>{Pe=e.u,Ce=e.a9,He=e.v,je=e.h,Be=e.aa,$e=e.G,Me=e._,Ue=e.e,We=e.c,Te=e.f,Ne=e.a,Le=e.d,Re=e.ab,Ve=e.m},e=>{De=e.s,Ae=e.d,Oe=e.e,qe=e.f,Ie=e.h,Ke=e.i,Fe=e.j,ze=e.k,Ee=e.l},e=>{Qe=e.u},e=>{Ge=e.a,Xe=e.b,Ye=e.c},e=>{Ze=e.u},e=>{Je=e.a5,et=e.a6,tt=e.a7,at=e.m,lt=e.h},e=>{it=e._},e=>{nt=e._},e=>{st=e._}],execute:function(){var ot=document.createElement("style");ot.textContent=".website-name[data-v-5103c19c]{display:flex;align-items:center;gap:8px;width:100%}.website-icon[data-v-5103c19c]{width:24px;flex-shrink:0;cursor:pointer}.website-info[data-v-5103c19c]{flex:1;min-width:0;overflow:hidden}.website-description[data-v-5103c19c]{margin-top:2px}.website-status[data-v-a66f2bce]{display:inline-flex;font-size:20px;cursor:pointer}.n-date-panel[data-v-4583ec55]{margin:0}.n-date-panel[data-v-4583ec55] .n-date-panel-calendar{padding:6px 0 12px}.n-date-panel[data-v-4583ec55] .n-date-panel--month .n-date-panel-footer{display:none}.n-date-panel[data-v-4583ec55] .n-date-panel-footer{padding:12px 0 6px}\n/*$vite$:1*/",document.head.appendChild(ot);const rt=I({__name:"index",props:{disabledKeys:{type:Array,default:()=>[]},hideKeys:{type:Array,default:()=>[]},storeKey:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(e){const t=K("tableRef"),n=F(!1),s=F([]),o=F([]),r=F([]),u=()=>{n.value=!0},d=()=>{n.value=!1},c=()=>{if(!t)return;const e=S(o.value.filter(e=>s.value.includes(String(e.key)))),a=e.length;if(a>0){const t=Math.floor(100/a),l=100-t*a;e.forEach((e,a)=>{if(i(e.width)||!e.width)return;let n=t;a<l&&(n+=1),e.width=`${n}%`})}"selection"===o.value[0].type&&e.unshift(o.value[0]),t.value.setColumns(e)},p=t=>{if(s.value.includes(t)?s.value=s.value.filter(e=>e!==t):s.value.push(t),e.storeKey&&l(e.storeKey,s.value.join(",")),e.loading){const t=E(()=>e.loading,e=>{e||c(),t()})}else c()};return z(()=>{if(t){const l=t.value.getColumns();0===o.value.length&&(o.value=S(l)),(()=>{if(e.storeKey){const t=a(e.storeKey);t&&(s.value=t.split(","))}})(),(()=>{const t=o.value.filter(e=>"selection"!==e.type);0===s.value.length&&(s.value=t.filter(t=>!e.hideKeys.includes(String(t.key))).map(e=>String(e.key))),r.value=t.map(t=>({key:String(t.key),disabled:"operate"===t.key||e.disabledKeys.includes(String(t.key)),label:()=>Z(ee,null,[Z(H,{checked:s.value.includes(String(t.key))},null),Z("span",{class:"ml-8px"},[String(t.title).includes("Requests")?"Requests":String(t.title)])])}))})();const i=E(()=>e.loading,e=>{e||c(),i()})}}),(e,t)=>{const a=C,l=P;return G(),Q(l,{placement:"bottom-end",show:X(n),"show-arrow":!0,"arrow-point-to-center":!0,options:X(r),onSelect:p,onClickoutside:d},{default:Y(()=>[Z(a,{onClick:u},{default:Y(()=>t[0]||(t[0]=[J("i",{class:"i-famicons:settings-outline text-16px"},null,-1)])),_:1,__:[0]})]),_:1},8,["show","options"])}}}),ut=e("u",te("SitePhpStore",()=>{const e=F(!1),t=F("--"),a=F(""),l=F("/www/wwwroot"),i=F(!0),r=F({setup:!0,type:"",version:"",status:!1}),u=F({setup:!1,version:"",status:!1}),d=F({setup:!1,version:"",status:!1}),c=F({is_install:0,status:!1,version:""}),p=F({is_install:0,status:!1,version:""}),m=ae(()=>1===c.value.is_install&&n(c.value.version,"4.1.2")),f=ae(()=>1===p.value.is_install&&n(p.value.version,"9.6.8")),y=F({setup:!1});return{web:r,ftp:u,siteName:t,mysql:d,php:y,sitePath:l,webserver:a,recycleBin:i,isRefresh:e,monitor:c,waf:p,isMonitorInstall:m,isWafInstall:f,getConfig:async()=>{const{message:e}=await s();o(e)&&(a.value=j(e,"webserver",""),l.value=j(e,"sites_path",""),i.value=j(e,"recycle_bin",!1),y.value.setup=!!e.php.length,o(e.web)&&(r.value=e.web),o(e["pure-ftpd"])&&(u.value=e["pure-ftpd"]),o(e.mysql)&&(d.value=e.mysql),o(e.monitor)&&(c.value=e.monitor),o(e.waf)&&(p.value=e.waf))},setRefresh:t=>{e.value=t}}})),dt=()=>{const{t:e}=le();return{openAddSiteModal:()=>{Pe({title:e("Site.PHP.index_9"),width:700,height:540,footer:!0,component:ie(()=>r(()=>t.import("./index-legacy234.js?v=1760428868419"),void 0))})},openBackupModal:a=>{Pe({title:e("Site.PHP.index_33",[a.name]),width:720,minHeight:200,data:{row:a},component:ie(()=>r(()=>t.import("./index-legacy235.js?v=1760428868419"),void 0))})},openSiteConfig:(a,l={})=>{Pe({title:e("Site.PHP.index_13",[a.name,a.addtime]),width:860,height:700,data:{siteInfo:a,config:Object.assign({menu:"",subMenu:""},l)},component:ie(()=>r(()=>t.import("./index-legacy236.js?v=1760428868419").then(e=>e.i),void 0))})},openDeleteSiteConfig:a=>{Pe({title:1===a.length?`${e("Site.Cert.index_56")} [${a[0].name}]`:`${e("Site.Cert.index_57")}`,width:480,minHeight:248,footer:!0,data:{rows:a},component:ie(()=>r(()=>t.import("./index-legacy237.js?v=1760428868419"),void 0))})},openSiteAdvancedModal:a=>{Pe({title:e("Database.Mysql.index_3"),width:950,height:620,data:{menu:a},component:ie(()=>r(()=>t.import("./index-legacy238.js?v=1760428868419"),void 0))})},openSslLogsModal:a=>{Pe({title:e("SSL.Domain.index_5"),width:700,height:450,data:{path:a},component:ie(()=>r(()=>t.import("./ssl-log-legacy.js?v=1760428868419"),void 0))})}}},ct={class:"website-name"},pt={key:1,class:"flex-center w-24px h-24px rounded-50%"},mt=["src"],ft={class:"flex flex-col flex-1 w-0 overflow-hidden"},yt={class:"flex items-center gap-8px"},vt={class:"min-w-0"},gt={class:"website-description"},ht=d(I({__name:"Name",props:{ico:{type:String,default:""},name:{type:String,default:"--"},description:{type:String,default:"--"}},emits:["clickName","clickServer","blur"],setup(e,{emit:t}){const a=u(),{theme:l}=ne(a),i=t,n=()=>{i("clickName")},s=()=>{i("clickServer")},o=()=>{window.open(`http://${e.name}`)},r=e=>{i("blur",e)};return(t,a)=>{const i=B,u=C,d=Ce;return G(),se("div",ct,[J("div",{class:"website-icon",onClick:s},[e.ico?(G(),se("div",pt,[J("img",{src:e.ico,class:"w-full h-full"},null,8,mt)])):(G(),se("div",{key:0,class:oe(["flex-center w-24px h-24px rounded-50%","dark"!==X(l)&&"bg-#F1F9F3"])},[J("i",{class:oe(["i-mdi:earth text-18px","dark"!==X(l)&&"text-primary"])},null,2)],2))]),J("div",ft,[J("div",yt,[J("div",vt,[Z(i,{class:"max-w-full",tooltip:{contentStyle:{maxWidth:"200px"}}},{default:Y(()=>[J("span",{class:oe(["cursor-pointer","dark"!==X(l)&&"text-primary"]),onClick:n},re(e.name),3)]),_:1})]),Z(u,{type:"primary",text:"",onClick:o},{default:Y(()=>a[0]||(a[0]=[J("i",{class:"i-fa-solid:external-link-alt"},null,-1)])),_:1,__:[0]})]),J("div",gt,[Z(d,{value:e.description,onBlur:r},null,8,["value"])])])])}}}),[["__scopeId","data-v-5103c19c"]]),_t={class:"i-famicons:play-circle-outline"},xt={class:"i-famicons:pause-circle-outline text-warning"},wt=d(I({__name:"Status",props:{status:{type:String,default:"0"},checkedValue:{type:String,default:"1"},unCheckedValue:{type:String,default:"0"},onUpdateValue:{type:Function}},setup(e){const t=()=>{e.onUpdateValue?.(e.status===e.checkedValue?e.unCheckedValue:e.checkedValue)};return(a,l)=>(G(),se("div",{class:"website-status",onClick:t},[ue(J("i",_t,null,512),[[de,e.status===e.checkedValue]]),ue(J("i",xt,null,512),[[de,e.status===e.unCheckedValue]])]))}}),[["__scopeId","data-v-a66f2bce"]]),kt=I({__name:"Backup",props:{count:{type:Number,default:0},lastTime:{type:String,default:""}},emits:["showBackup"],setup(e,{emit:t}){const a=t,l=()=>{a("showBackup")},i=t=>Je(new Date,e.lastTime||new Date)>=t,n=ae(()=>{if(0===e.count)return"Backup now";const t=Je(new Date,e.lastTime||new Date);return 0===t?"Today":1===t?"Yesterday":`${t} days ago`}),s=ae(()=>i(30)||e.count<=0?"error":i(7)?"warning":"primary");return(t,a)=>{const i=$,o=M;return G(),se("div",{class:"flex items-center gap-8px cursor-pointer",onClick:l},[Z(i,{type:X(s),size:"small",bordered:!1},{default:Y(()=>[ce(re(e.count),1)]),_:1},8,["type"]),Z(o,{disabled:0===e.count},{trigger:Y(()=>[J("div",{class:oe({"text-error":"error"===X(s),"text-warning":"warning"===X(s)})},re(X(n)),3)]),default:Y(()=>[ce(" "+re(e.lastTime),1)]),_:1},8,["disabled"])])}}}),bt={class:"inline-flex items-center w-full"},St={class:"flex-1 text-right"},Pt={class:"flex-1 text-left"},Ct=I({__name:"Quick",props:{path:{type:String,default:""},phpVersion:{type:String,default:""}},emits:["showPhp"],setup(e,{emit:t}){const a=t,l=pe(),i=()=>{p("Path",e.path),l.push("/files")},n=()=>{a("showPhp")};return(t,a)=>{const l=C,s=M,o=c;return G(),se("div",bt,[J("div",St,[Z(s,{trigger:"hover"},{trigger:Y(()=>[Z(l,{text:"",onClick:i},{default:Y(()=>a[0]||(a[0]=[J("i",{class:"i-fa:folder-open-o text-13px"},null,-1)])),_:1,__:[0]})]),default:Y(()=>[ce(" "+re(e.path),1)]),_:1})]),Z(o,{vertical:""}),J("div",Pt,[Z(l,{text:"",onClick:n},{default:Y(()=>[ce(re(e.phpVersion),1)]),_:1})])])}}}),Ht={class:"flex justify-end"},jt=d(I({__name:"ExpiredDate",props:{value:{type:String,default:"0000-00-00"},onUpdateValue:{type:Function}},setup(e){const{t:t}=le(),a=me("popoverRef"),l=F(null),i=ae(()=>{const t=new Date(e.value);return"0000-00-00"!==e.value&&et(t,tt())}),n=ae(()=>"0000-00-00"===e.value?t("Site.PHP.index_34"):i.value?t("Site.PHP.index_28"):e.value),s=e=>et(e,at(tt(),1)),o=ae(()=>{const t=new Date(e.value);return"0000-00-00"!==e.value&&et(t,at(tt(),7))}),r=async()=>{await(e.onUpdateValue?.("0000-00-00")),a.value?.setShow(!1)},u=async()=>{if(null===l.value)return;const t=lt(l.value,"yyyy-MM-dd");await(e.onUpdateValue?.(t)),a.value?.setShow(!1)},d=()=>{l.value="0000-00-00"===e.value?null:new Date(e.value).getTime()};return(e,t)=>{const c=C,p=W,f=m,y=U;return G(),Q(y,{ref_key:"popoverRef",ref:a,placement:"bottom",trigger:"click"},{trigger:Y(()=>[Z(c,{type:X(i)?"error":X(o)?"warning":"default",text:!0,onClick:d},{default:Y(()=>[ce(re(X(n)),1)]),_:1},8,["type"])]),default:Y(()=>[Z(f,{value:X(l),"onUpdate:value":t[0]||(t[0]=e=>fe(l)?l.value=e:null),type:"date",panel:!0,actions:null,"is-date-disabled":s},{footer:Y(()=>[J("div",Ht,[Z(p,{size:"small"},{default:Y(()=>[Z(c,{onClick:r},{default:Y(()=>[ce(re(e.$t("Site.PHP.index_34")),1)]),_:1}),Z(c,{disabled:null===X(l),onClick:u},{default:Y(()=>[ce(re(e.$t("Public.Btn.Confirm")),1)]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["value"])]),_:1},512)}}}),[["__scopeId","data-v-4583ec55"]]),Bt=["onClick"],$t={class:"whitespace-nowrap mr-10px"},Mt={class:"w-120px"},Ut=I({__name:"Ssl",props:{config:{type:[Number,Object],default:-1},sslApplyList:{type:Array,default:()=>[]}},emits:["click"],setup(e,{emit:t}){const a=t,{openSslLogsModal:l}=dt(),i=()=>{a("click")};return(t,a)=>{const n=C,s=N,r=f,u=T;return X(o)(e.config)?(G(),Q(n,{key:0,type:e.config.endtime<0?"error":"primary",text:"",onClick:i},{default:Y(()=>[ce(re(e.config.endtime<0?t.$t("Site.PHP.index_28"):t.$t("Site.PHP.index_29",[e.config.endtime])),1)]),_:1},8,["type"])):e.sslApplyList.length>0?(G(!0),se(ee,{key:1},ye(e.sslApplyList,e=>(G(),se("div",{class:"flex flex-nowrap! p-10px cursor-pointer justify-between items-center",key:e.task_name,onClick:t=>{return a=t,i=e.task_log,a.stopPropagation(),void l(i);var a,i}},[J("span",$t,re(e.task_name),1),Z(u,{class:"items-center flex-nowrap!"},{default:Y(()=>[J("div",Mt,[Z(s,{class:"w-full",type:"line",status:"success","indicator-placement":"inside",percentage:e.task_status,processing:100!==e.task_status},null,8,["percentage","processing"])]),Z(r,{name:"base-left-logs",size:"18",color:"#666666"})]),_:2},1024)],8,Bt))),128)):(G(),Q(n,{key:2,type:"warning",text:"",onClick:i},{default:Y(()=>[ce(re(t.$t("Site.PHP.index_30")),1)]),_:1}))}}}),Wt={class:"text-left"},Tt={class:"cursor-pointer"},Nt=I({__name:"Requests",props:{name:{type:String,default:""},total:{type:[Number,String],default:0},value:{type:Array,default:()=>[]}},setup(e){const{openMonitor:t}=Ze(),a=ae(()=>e.total.toLocaleString("en-US")),l=ae(()=>({xAxis:{type:"category",data:e.value.map(e=>e.date)},yAxis:{type:"value",show:!1},series:[{name:"页面浏览量",data:e.value.map(e=>e.value),type:"line",lineStyle:{color:"#20a53a",width:2},areaStyle:{color:"rgba(32, 165, 58, 0.1)"},symbol:"none"}],grid:{left:0,right:0,top:0,bottom:0}}));return(i,n)=>(G(),se("div",{class:"flex flex-col gap-3px cursor-pointer",onClick:n[0]||(n[0]=a=>X(t)(e.name))},[J("div",Wt,re(X(a)),1),J("div",Tt,[Z(it,{type:"line",option:X(l),height:"15px"},null,8,["option"])])]))}}),Lt={class:"flex w-full items-center"},Rt={class:"flex-1 flex items-center justify-end"},Vt={class:"flex-1 flex justify-start"},Dt=I({__name:"Waf",props:{siteName:{type:String,default:""},total:{type:Number,default:0},status:{type:Boolean,default:!1},onUpdateStatus:{type:Function}},setup(e){const{openSiteWaf:t}=Ze();return(a,l)=>{const i=C,n=c,s=L;return G(),se("div",Lt,[J("div",Rt,[Z(i,{text:"",onClick:l[0]||(l[0]=a=>X(t)(e.siteName))},{default:Y(()=>[ce(re(e.total),1)]),_:1})]),Z(n,{vertical:""}),J("div",Vt,[Z(s,{value:e.status,size:"small","onUpdate:value":e.onUpdateStatus},null,8,["value","onUpdate:value"])])])}}}),At={class:"inline-flex items-center"},Ot=I({__name:"OperateMenu",emits:["clickConfig","clickLog","clickOperate"],setup(e,{emit:t}){const a=t,l=[{key:"scan",label:"Security Scan",icon:()=>Z("i",{class:"i-ant-design:security-scan-outlined text-18px"},null)},{key:"delete",label:"Delete WebSite",icon:()=>Z("i",{class:"i-weui:delete-outlined text-18px"},null)}],i=e=>{a("clickOperate",e)};return(e,t)=>{const n=C,s=c,o=P;return G(),se("div",At,[Z(n,{type:"primary",text:"",onClick:t[0]||(t[0]=e=>a("clickConfig"))},{default:Y(()=>t[2]||(t[2]=[ce("Conf",-1)])),_:1,__:[2]}),Z(s,{vertical:""}),Z(n,{class:"mr-8px",type:"primary",text:"",onClick:t[1]||(t[1]=e=>a("clickLog"))},{default:Y(()=>t[3]||(t[3]=[ce("Log",-1)])),_:1,__:[3]}),Z(o,{trigger:"click",options:l,onSelect:i},{default:Y(()=>t[4]||(t[4]=[J("i",{class:"i-famicons:ellipsis-vertical text-18px cursor-pointer"},null,-1)])),_:1,__:[4]})])}}}),qt=I({__name:"index",emits:["fetchTable","update:sorter"],setup(e,{expose:t,emit:l}){const i=l,n=ut(),s=y(),{isFree:r,siteMonitorStatus:u}=ne(s),{webserver:d,waf:c,isWafInstall:p,monitor:m,isMonitorInstall:h}=ne(n),{t:_}=le(),{openBackupModal:x,openSiteConfig:w,openDeleteSiteConfig:k}=dt(),{setSiteStatus:b}=Ze(),S=F([{type:"selection",width:40,minWidth:40,maxWidth:40},{key:"name",title:_("Site.PHP.index_17"),minWidth:160,sorter:!0,sortOrder:!1,render:e=>Z(ht,{ico:e.ico,name:e.name,description:e.ps,onClickName:()=>{w(e)},onClickServer:()=>{w(e,{menu:"webserver"})},onBlur:async t=>{await De({id:e.id,ps:t}),e.ps=t}},null)},{key:"status",title:_("Public.Table.Status"),align:"center",className:"sort-center",width:90,minWidth:90,maxWidth:90,sorter:!0,sortOrder:!1,render:e=>Z(wt,{status:e.status,onUpdateValue:t=>{b(t,e)}},null)},{key:"backup_count",title:_("Site.PHP.index_19"),width:"10%",minWidth:110,render:e=>Z(kt,{count:e.backup_count,lastTime:e.last_backup_time,onShowBackup:()=>{x(e)}},null)},{key:"path",title:"Quick action",align:"center",width:"8%",minWidth:100,render:e=>Z(Ct,{path:e.path,phpVersion:e.php_version,onShowPhp:()=>{w(e,{menu:"php"})}},null)},He({type:"site",minWidth:70,callback:()=>{i("fetchTable")}}),{key:"edate",title:"Expiration",align:"center",width:"8%",minWidth:80,render:e=>Z(jt,{value:e.edate,onUpdateValue:async t=>{await Ae({id:e.id,edate:t}),e.edate=t}},null)},{key:"site_ssl",title:_("Site.PHP.index_27"),align:"center",width:100,minWidth:100,maxWidth:100,sorter:!0,sortOrder:!1,className:"sort-center",render:e=>{const t=D.value.filter(t=>t.target_id===e.id);return Z(Ut,{config:e.ssl,sslApplyList:t,onClick:()=>{w(e,{menu:"ssl"})}},null)}},{key:"requests",title:()=>Z(T,{class:"items-center justify-center!",size:3},{default:()=>[Z("span",null,[ce("Requests")]),Z(U,{trigger:"hover"},{trigger:()=>Z(f,{name:"base-problem",size:16},null),default:()=>Z(Me,null,{default:()=>[Z("li",null,[ce('If you don\'t need it, you can turn it off in "Settings" - "Panel Settings" - "Site Monitor".')]),Z("li",null,[ce("The monitoring report data will be updated as the website list is refreshed")])]})})]}),align:"center",width:"12%",minWidth:120,render:e=>{if("nginx"!==d.value&&"apache"!==d.value)return"--";if(r.value&&!u.value)return Z(C,{type:"primary",text:!0,onClick:()=>{$e({source:216})}},{default:()=>[ce("Active")]});if(!h.value&&"nginx"!==d.value)return Z(C,{type:"primary",text:!0,onClick:()=>{Qe("monitor",async()=>{await n.getConfig(),i("fetchTable"),$()})}},{default:()=>[1===m.value.is_install?_("Public.Btn.Update"):_("Public.Btn.Install")]});const t=H.value[e.name];if(!R(t)){const a=j(t),l=B(t);return Z(Nt,{name:e.name,total:a,value:l},null)}return"--"}},{key:"waf",title:"WAF",align:"center",width:"10%",minWidth:100,render:e=>{if("nginx"!==d.value)return"--";if(r.value)return Z(C,{type:"primary",text:!0,onClick:()=>{$e({source:216})}},{default:()=>[ce("Active")]});if(!p.value)return Z(C,{type:"primary",text:!0,onClick:()=>{Qe("btwaf",async()=>{await n.getConfig(),i("fetchTable"),N()})}},{default:()=>[1===c.value.is_install?_("Public.Btn.Update"):_("Public.Btn.Install")]});const t=M.value.find(t=>t.siteName===e.name);if(o(t)){const a=W(t);return Z(Dt,{siteName:e.name,total:a,status:t.open,onUpdateStatus:async a=>{await Ye({siteName:e.name,obj:"open"}),t.open=a}},null)}return"--"}},{key:"operate",title:_("Public.Table.Operation"),align:"right",width:110,minWidth:110,maxWidth:110,render:e=>Z(Ot,{onClickConfig:()=>{w(e)},onClickLog:()=>{w(e,{menu:"logs"})},onClickOperate:t=>{switch(t){case"scan":w(e,{menu:"logs",subMenu:"security"});break;case"delete":k([e])}}},null)}]),P=e=>{S.value.forEach(t=>{const a=t;a.key===e.columnKey?a.sortOrder=e.order:a.sortOrder=!1});const t=e.order?`${e.columnKey} ${"descend"===e.order?"desc":"asc"}`:"";i("update:sorter",t)},H=ve({}),j=e=>e.total?e.total.request:0,B=e=>e.list.map(e=>({date:e.date,value:e.request})),$=async()=>{if("nginx"!==d.value&&"apache"!==d.value)return;if(r.value&&!u.value)return;const{message:e}=await Ge((()=>{const e=new Date,t=at(e,-30);return{start_date:g(t,"yyyy-MM-dd"),end_date:g(e,"yyyy-MM-dd")}})());o(e)&&(H.value=e)},M=F([]),W=e=>e.total.reduce((e,t)=>e+t.value,0),N=async()=>{if(r.value)return;if(!p.value)return;const{message:e}=await Xe({p:1,limit:1e3,search:""});o(e)&&(M.value=v(e.data)?e.data.map(e=>({open:e.open,total:e.total,siteName:e.siteName})):[])};let L=null;const V=F(!1),D=F([]),A=async()=>{L&&clearTimeout(L);const{message:e}=await Be();v(e)&&(D.value=e,e.length>0?(V.value=!0,L=window.setTimeout(()=>{A()},3e3)):(V.value&&i("fetchTable"),L&&clearTimeout(L)))};return(()=>{const e=a("site-php-order","");if(e){const[t,a]=e.split(" "),l=S.value.find(e=>e.key===t);l&&(l.sortOrder="asc"===a?"ascend":"descend")}})(),t({getMonitorData:$,getNginxWafConfig:N,getSSLApplyList:A,getColumns:()=>S.value,setColumns:e=>{S.value=e}}),(e,t)=>{const a=je;return G(),Q(a,ge(e.$attrs,{columns:X(S),"onUpdate:sorter":P}),null,16,["columns"])}}}),It={class:"p-20px"},Kt={class:"flex-1"},Ft={class:"mt-12px"},zt={class:"px-20px pt-24px pb-8px"},Et={class:"w-150px"},Qt=I({__name:"set",props:{data:{}},setup(e){const{t:t}=le(),a=e,{setOptions:l}=a.data,i=F(""),n=async()=>{const e=i.value.trim();""!==e?(await Ie({name:e}),i.value="",await m(),l?.(c.data)):h.error(t("Site.PHP.index_46"))},s=Ue(),o=F(null),r=he({id:-1,name:""}),u={name:{required:!0,message:t("Site.PHP.index_46"),trigger:["blur","change"]}},d=async({hide:e})=>{await(o.value?.validate()),await Ke(_e(r)),await m(),l?.(c.data),e()},{table:c,columns:p}=We([{key:"name",title:"Name"},Te({width:120,options:e=>[{label:t("Public.Btn.Edit"),disabled:0===e.id,onClick:()=>{(e=>{r.id=e.id,r.name=e.name,s.title=`${t("Site.PHP.index_48")} [${e.name}]`,s.show=!0})(e)}},{label:t("Public.Btn.Delete"),disabled:0===e.id,onClick:()=>{Ne({title:`${t("Site.PHP.index_49")} [${e.name}]`,content:t("Site.PHP.index_50"),onConfirm:async({hide:t})=>{await Oe({id:e.id}),await m(),l?.(c.data,e.id),t()}})}}]})]),m=async()=>{const{message:e}=await qe();c.data=v(e)?e:[]};return m(),(e,t)=>{const a=V,l=C,m=T,f=D,y=A,v=st,g=nt;return G(),se("div",It,[Z(m,null,{default:Y(()=>[J("div",Kt,[Z(a,{value:X(i),"onUpdate:value":t[0]||(t[0]=e=>fe(i)?i.value=e:null),placeholder:e.$t("Site.PHP.index_46")},null,8,["value","placeholder"])]),J("div",null,[Z(l,{type:"primary",onClick:n},{default:Y(()=>[ce(re(e.$t("Site.Cert.index_62")),1)]),_:1})])]),_:1}),J("div",Ft,[Z(f,{"max-height":300,data:X(c).data,columns:X(p)},null,8,["data","columns"])]),Z(g,{show:X(s).show,"onUpdate:show":t[2]||(t[2]=e=>X(s).show=e),title:X(s).title,width:350,footer:!0,onConfirm:d},{default:Y(()=>[J("div",zt,[Z(v,{ref_key:"formRef",ref:o,model:X(r),rules:u},{default:Y(()=>[Z(y,{label:e.$t("Site.PHP.index_47"),path:"name"},{default:Y(()=>[J("div",Et,[Z(a,{value:X(r).name,"onUpdate:value":t[1]||(t[1]=e=>X(r).name=e),placeholder:""},null,8,["value"])])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["show","title"])])}}}),Gt={class:"w-160px"},Xt=I({__name:"index",props:{value:{default:null}},emits:["change","update:value"],setup(e,{emit:t}){const a=t,l=xe(e,"value"),{t:i}=le(),{loading:n,setLoading:s}=Le(),o=F([]),r=async e=>{a("change"),a("update:value",e),sessionStorage.setItem("typeValue",e)},u=Ue(i("Site.PHP.index_44"),{setOptions:(e,t)=>{t===l.value&&(l.value=-1),o.value=e.map(e=>({label:e.name,value:e.id})),c()}}),d=()=>{u.show=!0},c=()=>{o.value.unshift({label:i("Site.PHP.index_45"),value:-1})};return c(),z(()=>{(async()=>{try{s(!0);const{message:e}=await qe();v(e)?o.value=e.map(e=>({label:e.name,value:e.id})):o.value=[],c()}finally{s(!1);const e=sessionStorage.getItem("typeValue");l.value=e?Number(e):-1}})()}),(e,t)=>{const a=C,i=O,s=nt;return G(),se("div",Gt,[Z(i,{value:X(l),"onUpdate:value":t[0]||(t[0]=e=>fe(l)?l.value=e:null),loading:X(n),options:X(o),onUpdateValue:r},{action:Y(()=>[Z(a,{block:"",onClick:d},{default:Y(()=>[ce(re(e.$t("Site.PHP.index_43")),1)]),_:1})]),_:1},8,["value","loading","options"]),Z(s,{show:X(u).show,"onUpdate:show":t[1]||(t[1]=e=>X(u).show=e),width:350,title:X(u).title,data:X(u).data,component:Qt},null,8,["show","title","data"])])}}}),Yt=I({__name:"index",setup(e){const i=ut(),n=y(),{web:s,webserver:o}=ne(i),{t:u}=le(),{openAddSiteModal:d,openSiteAdvancedModal:c,openDeleteSiteConfig:p}=dt(),{tableConfig:m,tableData:f,pageConfig:v,tableParams:g,fetchTable:h,resetTable:S,setLoading:H}=Re({params:{p:1,limit:10,table:"sites",search:"",order:a("site-php-order",""),type:-1},immediate:!1,fetchFn:Ee}),j=me("siteTableRef");ke("tableRef",j);const B=F(!1),$=F([]),M=[{label:u("Site.PHP.index_5"),key:"default-page"},{label:u("Site.PHP.index_6"),key:"default-site"},{label:u("Site.PHP.index_7"),key:"php-version"},{label:u("Site.PHP.index_86"),key:"https"}],U=[{key:"enable",type:"confirm",label:u("Site.Batch.index_1"),confirm:{title:u("Site.Batch.index_2"),desc:u("Site.Batch.index_3"),columns:[{key:"name",title:u("Site.PHP.index_17")}],api:e=>Fe(!0,{id:e.id,name:e.name},!1),done:()=>{h(!1)}}},{key:"disable",type:"confirm",label:u("Site.Batch.index_4"),confirm:{title:u("Site.Batch.index_5"),desc:u("Site.Batch.index_6"),columns:[{key:"name",title:u("Site.PHP.index_17")}],api:e=>Fe(!1,{id:e.id,name:e.name},!1),done:()=>{h(!1)}}},{key:"backup",type:"confirm",label:u("Site.Batch.index_7"),confirm:{title:u("Site.Batch.index_8"),desc:u("Site.Batch.index_9"),columns:[{key:"name",title:u("Site.PHP.index_17")}],api:e=>ze({id:e.id},!1),done:()=>{h(!1)}}},{key:"expired",label:u("Site.PHP.index_70"),onBatch:e=>{Pe({title:u("Site.PHP.index_71"),width:380,minHeight:72,footer:!0,data:{rows:e},component:ie(()=>r(()=>t.import("./expired-legacy.js?v=1760428868419"),void 0))})}},{key:"php",label:u("Site.PHP.index_66"),onBatch:e=>{Pe({title:u("Site.PHP.index_65"),width:500,minHeight:198,footer:!0,data:{rows:e},component:ie(()=>r(()=>t.import("./php-legacy2.js?v=1760428868419"),void 0))})}},{key:"category",label:u("Crontab.Planned.index_19"),onBatch:e=>{Pe({title:u("Site.Batch.index_22"),width:350,minHeight:72,footer:!0,data:{rows:e},component:ie(()=>r(()=>t.import("./category-legacy.js?v=1760428868419"),void 0))})}},{key:"webserver",label:"Switch service",onBatch:e=>{Pe({title:"Batch switch service",width:450,minHeight:150,footer:!0,data:{rows:e},component:ie(()=>r(()=>t.import("./webserver-legacy.js?v=1760428868419"),void 0))})}},{key:"delete",label:u("Site.Batch.index_10"),onBatch:e=>{p(e)}}],T=()=>{d()},N=e=>{g.value.order=e,l("site-php-order",e),h()},L=e=>{c(e)},R=async()=>{await S(),j.value?.getNginxWafConfig(),j.value?.getMonitorData(),j.value?.getSSLApplyList(),$.value=[]},V=async(e=!1)=>{await h(e,!0),j.value?.getSSLApplyList(),j.value?.getNginxWafConfig(),j.value?.getMonitorData(),$.value=[]},D=async()=>{try{H(!0),await i.getConfig(),B.value=s.value.setup,s.value.setup&&await V()}finally{H(!1)}};return E(()=>i.isRefresh,e=>{e&&(i.setRefresh(!1),V())}),E(()=>n.taskCount,()=>{D()}),H(!0),z(async()=>{D()}),(e,t)=>{const a=_,l=C,i=P,n=W,r=Se,u=be,d=rt,p=b,y=k,S=w,H=x,D=q;return G(),Q(D,null,{default:Y(()=>[Z(H,{install:X(s).setup},{desc:Y(()=>[J("span",null,re(e.$t("Site.PHP.index_1")),1),Z(a,{class:"ml-4px",onClick:t[0]||(t[0]=e=>X(Ve)("nginx"))},{default:Y(()=>[ce(re(e.$t("Site.PHP.index_2")),1)]),_:1}),t[7]||(t[7]=J("span",{class:"mx-4px"},"|",-1)),Z(a,{onClick:t[1]||(t[1]=e=>X(Ve)("apache"))},{default:Y(()=>[ce(re(e.$t("Site.PHP.index_3")),1)]),_:1})]),default:Y(()=>[Z(S,{class:"p-16px",feedback:!0},{toolsLeft:Y(()=>[Z(l,{type:"primary",class:"add-site-btn",onClick:T},{default:Y(()=>[ce(re(e.$t("Site.PHP.index_4")),1)]),_:1}),Z(n,null,{default:Y(()=>[Z(l,{onClick:t[2]||(t[2]=e=>X(c)())},{default:Y(()=>[ce(re(e.$t("Database.Mysql.index_3")),1)]),_:1}),Z(i,{trigger:"hover",options:M,onSelect:L},{default:Y(()=>[Z(l,null,{default:Y(()=>t[8]||(t[8]=[J("i",{class:"i-fa:angle-down"},null,-1)])),_:1,__:[8]})]),_:1})]),_:1}),X(B)?(G(),Q(r,{key:0,"soft-name":X(o),"is-web-site":!0},null,8,["soft-name"])):we("",!0)]),toolsRight:Y(()=>[Z(Xt,{value:X(g).type,"onUpdate:value":t[3]||(t[3]=e=>X(g).type=e),onChange:R},null,8,["value"]),Z(u,{value:X(g).search,"onUpdate:value":t[4]||(t[4]=e=>X(g).search=e),placeholder:e.$t("Site.PHP.index_8"),onSearch:R},null,8,["value","placeholder"]),Z(d,{"store-key":"site-php-columns",loading:X(m).loading,"hide-keys":["quota"],"disabled-keys":["name"]},null,8,["loading"])]),table:Y(()=>[Z(qt,ge({ref_key:"siteTableRef",ref:j,"checked-row-keys":X($),"onUpdate:checkedRowKeys":t[5]||(t[5]=e=>fe($)?$.value=e:null)},X(m),{onFetchTable:X(h),"onUpdate:sorter":N}),null,16,["checked-row-keys","onFetchTable"])]),pageLeft:Y(()=>[Z(p,{"checked-row-keys":X($),"onUpdate:checkedRowKeys":t[6]||(t[6]=e=>fe($)?$.value=e:null),data:X(f),options:U},null,8,["checked-row-keys","data"])]),pageRight:Y(()=>[Z(y,ge(X(v),{"store-key":"site-php-page",onRefresh:V}),null,16)]),_:1})]),_:1},8,["install"])]),_:1})}}}),Zt=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"}));e("i",Zt)}}});
