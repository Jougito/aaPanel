System.register(["./index-legacy.js?v=1760428868419","./page_layout-legacy.js?v=1760428868419","./public-legacy.js?v=1760428868419","./index-legacy39.js?v=1760428868419","./vue-legacy.js?v=1760428868419","./naive-legacy.js?v=1760428868419","./common-legacy.js?v=1760428868419","./__commonjsHelpers__-legacy.js?v=1760428868419","./soft-legacy2.js?v=1760428868419","./soft-legacy.js?v=1760428868419","./site-legacy.js?v=1760428868419","./file-legacy2.js?v=1760428868419","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1760428868419"],function(e,l){"use strict";var t,a,i,s,o,n,d,r,u,p,c,f,v,m,g,x,y,h,w,b,_,k,M,j,C,$,z,S,P,F,U,I,N;return{setters:[e=>{t=e._},e=>{a=e.n,i=e._,s=e.co,o=e.m,n=e.t,d=e.p},e=>{r=e.a},e=>{u=e.u,p=e.g},e=>{c=e.k,f=e.P,v=e.i,m=e.r,g=e.W,x=e.a2,y=e.V,h=e.a3,w=e.S,b=e.a4,_=e.U,k=e.ak,M=e.c,j=e.R,C=e.j,$=e.an,z=e.F,S=e.O,P=e.I,F=e.n},e=>{U=e.dg,I=e.di,N=e.aC},null,null,null,null,null,null,null],execute:function(){var l=document.createElement("style");l.textContent='@charset "UTF-8";.modal-footer-btns[data-v-d4a59164]{display:flex;align-items:center;flex-direction:row;justify-content:end;gap:10px;padding:10px}.single-line-ellipsis[data-v-d4a59164]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.files-list-wrapper .files-tit[data-v-d4a59164],.files-list-wrapper .list-item[data-v-d4a59164]{display:flex;justify-content:flex-start;padding:14px 10px;border-bottom:1px solid var(--color-border);position:relative}.files-list-wrapper .files-tit .progress[data-v-d4a59164],.files-list-wrapper .list-item .progress[data-v-d4a59164]{position:absolute;width:0;height:100%;background:rgba(11,199,43,.1);left:0;top:0;transition:all .25s ease-in-out}.files-list-wrapper .files-tit span[data-v-d4a59164],.files-list-wrapper .list-item span[data-v-d4a59164]{box-sizing:border-box;padding-left:10px}.files-list-wrapper .files-tit .name[data-v-d4a59164],.files-list-wrapper .list-item .name[data-v-d4a59164]{flex:4}.files-list-wrapper .files-tit .size[data-v-d4a59164],.files-list-wrapper .list-item .size[data-v-d4a59164],.files-list-wrapper .files-tit .status[data-v-d4a59164],.files-list-wrapper .list-item .status[data-v-d4a59164]{flex:2;text-align:center}.files-list-wrapper .files-tit .operation[data-v-d4a59164],.files-list-wrapper .list-item .operation[data-v-d4a59164]{flex:2;text-align:right}.status-tools-wrapper[data-v-d4a59164]{box-sizing:border-box}.status-tools-wrapper .status-tools[data-v-d4a59164]{display:flex;align-items:center;flex-direction:row;justify-content:start;padding:0 20px;gap:15px;background:#dff0d8;border-radius:10px}.status-tools-wrapper .status-tools .tools-item[data-v-d4a59164]{display:flex;flex-direction:row;justify-content:start;align-items:center;gap:5px}.status-tools-wrapper .status-tools .tools-item .item-label[data-v-d4a59164],.status-tools-wrapper .status-tools .tools-item .value[data-v-d4a59164]{height:40px;line-height:40px;color:#3c763d}.file-empty[data-v-d4a59164]{display:flex;justify-content:center;align-items:center;height:440px;border:2px dashed var(--color-border);border-radius:10px;font-size:30px;color:var(--color-text-3)}\n/*$vite$:1*/',document.head.appendChild(l);const L={class:"p-20px"},R={class:"flex items-center gap-10px mb-16px"},A={class:"flex-1 w-0 text-14px"},E=c({__name:"FileConflict",props:{fileList:{}},emits:["step","confirm"],setup(e,{emit:l}){const{t:s}=f(),o=l,n=v("fileStore"),{fileConflictShow:d}=n,r=m([{title:s("file.uploadModal.conflictFileName"),key:"filename",ellipsis:{tooltip:!0}},{title:s("file.uploadModal.conflictFileDifference"),key:"difference",width:200,render:e=>g("span",null,[a(e.size)+"--\x3e"+a(e.size)])}]),u=()=>{o("step")},p=()=>{o("confirm")};return(e,l)=>{const a=i,o=U,n=t;return y(),x(n,{show:_(d),"onUpdate:show":l[0]||(l[0]=e=>k(d)?d.value=e:null),title:_(s)("file.uploadModal.conflictTitle"),width:600,footer:!0,"confirm-text":_(s)("file.uploadModal.conflictOverwrite"),"cancel-text":_(s)("file.uploadModal.conflictSkip"),onCancel:u,onConfirm:p},{default:h(()=>[w("div",L,[w("div",R,[g(a,{name:"base-warning",class:"text-warning text-30px"}),w("div",A,b(_(s)("file.uploadModal.conflictMessage")),1)]),g(o,{"max-height":400,columns:_(r),data:e.fileList},null,8,["columns","data"])])]),_:1},8,["show","title","confirm-text","cancel-text"])}}}),T={class:"p-20px"},B={key:0,class:"flex justify-between items-center mb-16px"},H={key:1,class:"status-tools-wrapper mb-16px"},O={class:"status-tools"},D={class:"tools-item"},V={class:"item-label"},W={class:"value"},q={class:"tools-item"},G={class:"item-label"},J={class:"value"},K={class:"tools-item"},Q={class:"item-label"},X={class:"value"},Y={key:0,class:"tools-item"},Z={class:"item-label"},ee={class:"value"},le={key:2,class:"files-list-wrapper"},te={class:"files-tit"},ae={class:"name"},ie={class:"size"},se={class:"status"},oe={class:"operation"},ne={class:"name"},de={class:"size"},re={class:"status"},ue={class:"operation"},pe={key:3,class:"file-empty"},ce={class:"flex justify-end gap-16px mt-20px"};e("default",d(c({__name:"UploadFile",setup(e,{expose:l}){const d=v("fileStore"),{uploadFileList:c,uploadShow:U}=d,{currentPath:L,uploadComplete:R,startUpload:A,fileConflictShow:fe}=d,ve=m([]),{t:me}=f(),ge=m({total:0,done:0,time:0,speed:0,num:0}),xe=m(),ye=m(),he=m([{key:"file",label:M(()=>me("file.uploadFile"))},{key:"dir",label:M(()=>me("file.uploadFolder"))}]);function we(e){"file"==e?be():ye.value.click()}function be(){xe.value.click()}function _e(e){const l=e.target.files;if(l){let e=!1;for(let t=0;t<l.length;t++)-1==c.value.findIndex(e=>e.file.name==l[t].name)?c.value.push({relativePath:"",file:l[t],status:0,name:l[t].name,size:l[t].size,progress:0}):e=!0;e&&o.error(me("file.uploadModal.fileAlreadyExists"),{close:!0})}xe.value.value=""}function ke(e){const l=e.target.files;if(l){let e=!1;for(let t=0;t<l.length;t++){let a=l[t].webkitRelativePath.split("/");a.pop(),-1==c.value.findIndex(e=>e.file.name==l[t].name)?c.value.push({relativePath:a.join("/"),file:l[t],name:l[t].name,status:0,size:l[t].size,progress:0}):e=!0}e&&o.error(me("file.uploadModal.fileAlreadyExists"),{close:!0})}ye.value.value=""}function Me(){c.value=[]}function je(e){switch(e){case 0:return me("file.uploadModal.statusNotStarted");case 1:return me("file.uploadModal.statusUploading");case 2:return me("file.uploadModal.statusCompleted");case 3:return me("file.uploadModal.statusFailed")}}async function Ce(){const e=c.value.map(e=>e.relativePath?L.value+"/"+e.relativePath+"/"+e.file.name:L.value+"/"+e.file.name),l=await async function(e){return(await n.post("/files?action=upload_files_exists",{files:e.join("\n")})).message.filter(e=>e.exists)}(e);0==l.length?await Se():(console.log(c),ve.value=l,fe.value=!0)}function $e(){fe.value=!1,async function(){c.value=c.value.filter(e=>-1==ve.value.findIndex(l=>l.filename.includes(e.file.name))),c.value.length>0?await Se():Pe()}()}function ze(){fe.value=!1,Se()}async function Se(){ge.value.total=c.value.reduce((e,l)=>e+l.file.size,0),A.value=!0;const e=function(){let e=0;const l=setInterval(()=>{e++,ge.value.time=e,ge.value.speed=ge.value.done/ge.value.time,console.log(ge.value)},1e3);return l}();for(let t=0;t<c.value.length;t++){c.value[t].status=1;try{await u(c.value[t].file,"/files?action=upload",1048576,L.value+"/"+c.value[t].relativePath,e=>{c.value[t].progress=e},e=>{isNaN(Number(e.message))||(ge.value.done=Number(e.message))}),c.value[t].status=2,ge.value.num+=1}catch(l){c.value[t].status=3,console.warn(l)}}clearInterval(e),R.value=!0,p(d),F(()=>c.value=[]),console.log("上传结束")}function Pe(){R.value=!1,A.value=!1,ge.value={total:0,done:0,speed:0,num:0,time:0},c.value=[]}l({open(){U.value=!0},close(){U.value=!1}});const Fe=()=>{if(!R.value&&c.value.length>0)return r({title:me("file.uploadModal.cancelUpload"),content:me("file.uploadModal.cancelUploadConfirm"),onConfirm(){U.value=!1}}),!1},Ue=()=>{Pe()};return(e,l)=>{const o=i,n=N,d=I,r=s,u=t;return y(),j(z,null,[g(u,{show:_(U),"onUpdate:show":l[0]||(l[0]=e=>k(U)?U.value=e:null),title:e.$t("file.uploadModal.title"),width:720,onPublicClose:Fe,onAfterLeave:Ue},{default:h(()=>[w("div",T,[w("input",{type:"file",style:{display:"none"},ref_key:"fileInputRef",ref:xe,onChange:_e,multiple:""},null,544),w("input",{type:"file",style:{display:"none"},ref_key:"dirInputRef",ref:ye,onChange:ke,webkitdirectory:"",directory:"",multiple:""},null,544),_(A)&&0!=_(c).length?(y(),j("div",H,[w("div",O,[w("div",D,[w("div",V,b(e.$t("file.uploadModal.uploadSize")),1),w("div",W,b(`${_(a)(_(ge).done)}/${_(a)(_(ge).total)}`),1)]),w("div",q,[w("div",G,b(e.$t("file.uploadModal.averageSpeed")),1),w("div",J,b(_(a)(_(ge).speed))+"/s",1)]),w("div",K,[w("div",Q,b(e.$t("file.uploadModal.uploadSuccess")),1),w("div",X,b(_(c).length)+" / "+b(_(ge).num),1)]),_(R)?(y(),j("div",Y,[w("div",Z,b(e.$t("file.uploadModal.totalTime")),1),w("div",ee,b(_(ge).time)+"s",1)])):$("",!0)])])):(y(),j("div",B,[g(d,{options:_(he),trigger:"hover",onSelect:we},{default:h(()=>[g(n,{type:"primary","icon-placement":"right",onClick:be},{icon:h(()=>[g(o,{name:"base-arrow-bottom",size:"14"})]),default:h(()=>[C(b(e.$t("file.uploadFile"))+" ",1)]),_:1})]),_:1},8,["options"]),g(n,{disabled:0==_(c).length,onClick:Me},{default:h(()=>[C(b(e.$t("Public.Btn.Clear")),1)]),_:1},8,["disabled"])])),_(c).length>0?(y(),j("div",le,[w("div",te,[w("span",ae,b(e.$t("file.uploadModal.fileName")),1),w("span",ie,b(e.$t("file.uploadModal.fileSize")),1),w("span",se,b(e.$t("file.uploadModal.uploadStatus")),1),w("span",oe,b(e.$t("file.uploadModal.operation")),1)]),g(r,{style:{height:"350px"}},{default:h(()=>[(y(!0),j(z,null,S(_(c),(l,t)=>(y(),j("div",{class:"list-item",key:t},[w("span",ne,b(l.relativePath?`${l.relativePath}/${l.file.name}`:l.file.name),1),w("span",de,b(_(a)(l.file.size)),1),w("span",re,b(je(l.status)),1),w("span",ue,[2!==l.status?(y(),x(n,{key:0,text:"",type:"primary",onClick:e=>function(e){c.value.splice(e,1)}(t)},{default:h(()=>[C(b(e.$t("Public.Btn.Cancel")),1)]),_:2},1032,["onClick"])):$("",!0)]),w("div",{class:"progress",style:P({width:`${l.progress}%`})},null,4)]))),128))]),_:1})])):(y(),j("div",pe,[w("span",null,b(e.$t("file.uploadModal.dragFilesHere")),1)])),w("div",ce,[_(A)?(y(),x(n,{key:0,type:"primary",disabled:0==_(c).length,onClick:Ce},{default:h(()=>[C(b(e.$t("file.uploadModal.continueUpload")),1)]),_:1},8,["disabled"])):(y(),x(n,{key:1,type:"primary",disabled:0==_(c).length,onClick:Ce},{default:h(()=>[C(b(e.$t("file.uploadModal.confirmUpload")),1)]),_:1},8,["disabled"]))])])]),_:1},8,["show","title"]),g(E,{"file-list":_(ve),onStep:$e,onConfirm:ze},null,8,["file-list"])],64)}}}),[["__scopeId","data-v-d4a59164"]]))}}});
