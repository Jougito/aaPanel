const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/form9.js?v=1760428868419","js/index.vue_vue_type_script_setup_true_lang.js?v=1760428868419","js/vue.js?v=1760428868419","js/__commonjsHelpers__.js?v=1760428868419","js/naive.js?v=1760428868419","js/common.js?v=1760428868419","js/term.js?v=1760428868419","js/page_layout.js?v=1760428868419","js/public.js?v=1760428868419","css/public.css?v=1760428868419","css/page_layout.css?v=1760428868419"])))=>i.map(i=>d[i]);
import{x as e,a as t,b as o,c as a}from"./xterm.js?v=1760428868419";import{x as n}from"./xterm-addon-canvas.js?v=1760428868419";import{_ as s,k as d,P as i,af as r,a0 as l,r as c,w as u,ap as p,o as v,b as m,R as f,V as w,n as h}from"./vue.js?v=1760428868419";import{a as x,d6 as A,p as _}from"./page_layout.js?v=1760428868419";import{u as b,D as g}from"./public.js?v=1760428868419";const O=e=>{b({title:e.title,width:600,footer:!0,data:e.data,component:s(()=>x(()=>import("./form9.js?v=1760428868419"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])))})},S=_(d({__name:"terminal",props:{data:{},active:{type:Boolean}},emits:["updateState","connectSuccess"],setup(s,{expose:d,emit:x}){const{t:_}=i(),b=s,{data:S}=b,{active:y}=r(b),j=x,k=A(),{isFull:C}=l(k),{ws:T,status:D,send:E,open:R,close:z}=g("/webssh",{verifyData:{host:S.host,port:S.port,id:S.id,ps:S.ps,sort:0},onMessage:(e,t)=>{const o=t.data;return o.indexOf("Authentication timeout.")>-1&&(P.value=!0),-1==o.indexOf("@127.0.0.1:")&&-1==o.indexOf("@localhost:")||-1==o.indexOf("Authentication failed")?-1==o.indexOf("127.0.0.1:")&&-1==o.indexOf("localhost:")||-1==o.indexOf("Password or private key cannot both be empty")?"\\r\\nlogout\\r\\n"==o||"logout\\r\\n"==o||"\r\nlogout\r\n"==o||"logout\r\n"==o||o.search(/logout[\r\n]+$/)>-1?(j("updateState",S.id,!1),L.write("\r"+_("Component.Terminal.index_1")+"\r"),N(),void z()):void j("connectSuccess",o):(j("updateState",S.id,!1),z(),N(),void F()):(j("updateState",S.id,!1),z(),void N())}}),F=()=>{O({title:"Edit server",data:{isEdit:!0,tips:!0,localhost:!0,onRefresh:()=>{q()}}})};let L,M;const P=c(!1),B=c(null),I=()=>{const e=T.value;e&&(L.loadAddon(M),L.loadAddon(new n.CanvasAddon),L.loadAddon(new o.WebLinksAddon),L.loadAddon(new a.AttachAddon(e)),setTimeout(()=>{M.fit();const e=B.value;e&&(W.value="".concat(e.clientHeight,"px"))},100))},V=()=>{B.value&&L.open(B.value)};let H=!1;const N=()=>{H=!1},W=c(""),$=()=>{L.focus(),L.onData(e=>{const t=T.value;"\r"===e&&P.value&&(P.value=!1,L.write("\r\n"),q()),void 0!==t||"\r"!==e||H||(H=!0,L.write("\r\n"+_("Component.Terminal.index_2")+"\r\n"),q())})},q=()=>{R(),$();const e=T.value;e&&(L.loadAddon(new a.AttachAddon(e)),j("updateState",S.id,!0))},G=()=>{h(()=>{if(M.fit(),"CLOSED"!==D.value){j("updateState",S.id,!0);const{cols:e,rows:t}=L;E({cols:e,rows:t,resize:1})}})};u(()=>C.value,e=>{const t=B.value;t&&!e&&(t.style.height=W.value)});let J=!0;const K=new ResizeObserver(()=>{y.value&&p(()=>{J?J=!1:G()},200)()});return d({send:E}),v(()=>{L=new e.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#333",foreground:"#ececec"}}),M=new t.FitAddon,I(),V(),$(),G(),(()=>{const e=B.value;e&&K.observe(e)})()}),m(()=>{null==K||K.disconnect()}),(e,t)=>(w(),f("div",{ref_key:"terminalRef",ref:B,class:"w-full box"},null,512))}}),[["__scopeId","data-v-12768f9a"]]);export{S as T,O as o};
