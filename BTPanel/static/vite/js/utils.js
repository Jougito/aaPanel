import{c as e,r as a}from"./public.js?v=1760428868419";import{t as s,i as t,d as i,n as l,_ as n}from"./page_layout.js?v=1760428868419";import{a as o}from"./soft.js?v=1760428868419";import{Z as r,r as u,W as c,j as _,a0 as p,F as d}from"./vue.js?v=1760428868419";import{dX as m,d8 as g}from"./naive.js?v=1760428868419";const k=()=>s.post("/mod/backup_restore/com/get_backup_list"),f=e=>s.post("/mod/backup_restore/com/add_backup",e,{requestOptions:{loading:t.global.t("Component.Pay.index_12"),successMessage:!0}}),b=e=>s.post("/mod/backup_restore/com/get_progress",e),y=e=>s.post("/mod/backup_restore/com/task_stop",e,{requestOptions:{loading:t.global.t("Component.Pay.index_12"),successMessage:!0}}),x=e=>s.post("/mod/backup_restore/com/exec_backup",e,{requestOptions:{loading:t.global.t("Component.Pay.index_12"),successMessage:!0}}),C=(e,a=!0)=>s.post("/mod/backup_restore/com/del_backup",e,{requestOptions:{loading:a?t.global.t("Component.Pay.index_12"):"",successMessage:a}}),B=e=>s.post("/mod/backup_restore/com/get_details",e),v=e=>s.post("/mod/backup_restore/com/get_exec_logs",e),w=e=>s.post("/mod/backup_restore/com/add_restore",e,{requestOptions:{loading:t.global.t("Component.Pay.index_12"),successMessage:!0}}),{t:z}=t.global,h=r("backup",()=>{const e=u(!1),a=u(!1),t=u([]),l=u({});return{backupData:l,storageType:t,showBackupStatus:a,loading:e,getData:async n=>{try{let o;if(e.value=!0,n)a.value=!0,o=n;else{a.value=!1;o=(await s.post("/mod/backup_restore/com/get_data_total")).message}i(o)&&(N.value=o.oss_list&&o.oss_list.length?o.oss_list.map(e=>({label:e.name,value:e.value,disabled:!e.status})):[],N.value.unshift({value:"local",label:z("Crontab.Script.index_24"),disabled:!1}),l.value=o,F.data=o.site_list,I.data=o.database_list,W.data=[{name:"SSH",size:o.ssh_info.ssh_size,status:o.ssh_info.status,err_msg:o.ssh_info.err_msg},{name:"Command",size:o.ssh_info.command_size,status:o.ssh_info.status,err_msg:o.ssh_info.err_msg}],A.data=o.wp_list,G.data=o.ftp_list,K.data=o.crontab_list,V.data=[{name:"IP Rules",value:o.firewall_info.firewall_ip,status:o.firewall_info.status,err_msg:o.firewall_info.err_msg},{name:"Region Rules",value:o.firewall_info.firewall_conutry,status:o.firewall_info.status,err_msg:o.firewall_info.err_msg},{name:"Port Rules",value:o.firewall_info.firewall_new,status:o.firewall_info.status,err_msg:o.firewall_info.err_msg},{name:"Port Forwarding Rules",value:o.firewall_info.firewall_forward,status:o.firewall_info.status,err_msg:o.firewall_info.err_msg}],ee.data=o.plugin_list,se.data=o.soft_data,Y.data=Object.values(o.vmail_info).length?[o.vmail_info]:[],Q.data=[...o.ssl_info.ssl_list.map(e=>({...e,type:"ssl"})),...o.ssl_info.provider_list.map(e=>({...e,type:"provider"}))],o.oss_list&&o.oss_list.length&&(t.value=o.oss_list.map(e=>({label:e.name,value:e.value,disabled:!e.status})).concat({label:"Local Storage",value:"local",disabled:!1})))}finally{e.value=!1}}}}),P=h(),{showBackupStatus:j}=p(P),{t:D}=t.global,M=e=>e<Date.now()-864e5,N=u([]),S=e=>e.disabled?c("div",null,[c("span",null,[e.label]),c("span",{class:"float-right cursor-pointer color-#ef0808",onClick:()=>(async(e,s)=>{await a(e),await o({name:e,title:s,admin:!0})})(e.value,e.label)},[_("["),D("Crontab.Planned.index_47"),_("]")])]):c("span",null,[e.label]),q=e=>{const a=new Date(e||Date.now()),s=e=>e<10?"0"+e:e,t=a.getFullYear(),i=s(a.getMonth()+1),l=s(a.getDate()),n=s(a.getHours()),o=s(a.getMinutes());return"Backup-".concat(t,"-").concat(i,"-").concat(l,"-").concat(n).concat(o)},O=e=>({key:"name",title:D("Config.Backup.index_22"),render:a=>0===a.backup_status?c("span",{class:"text-#999"},[D("Config.Backup.index_23")]):1===a.restore_status?c("span",{class:"text-warning cursor-pointer",onClick:()=>{e("restore")}},[D("Config.Backup.index_24")]):1===a.backup_status?c("span",{class:"text-primary cursor-pointer",onClick:()=>{e("backup")}},[D("Config.Backup.index_25")]):c("div",{class:"items-center! cursor-pointer",onClick:()=>{e("log",a)}},[c(m,{type:"success",dot:!0},null),_(" "),D("Config.Backup.index_26"),_("("),a.backup_count.success||"--",_(")"),c(m,{type:"error",class:"ml-10px!",dot:!0},null),_(" "),D("Config.Backup.index_27"),_("("),a.backup_count.failed||"--",_(")")])}),R=()=>({title:D("Public.Table.Status"),key:"status",align:"center",width:80,render:e=>j.value?2===e.status?c(n,{name:"base-success",class:"text-#20a53a",size:"16"},null):c(g,null,{trigger:()=>c(n,{name:"base-error",class:"text-error",size:"16"},null),default:()=>c(d,null,[e.err_msg])}):c("span",{class:"text-#20a53a"},[_("Ready")])}),{table:F,columns:H}=e([{title:D("Config.Backup.index_28"),key:"name"},{title:D("Config.Backup.index_29"),key:"size",render:e=>l(Number(e.size))},{title:D("Config.Backup.index_30"),key:"type"},R()]),{table:I,columns:T}=e([{title:D("Config.Backup.index_31"),key:"name"},{title:D("Config.Backup.index_32"),key:"size",render:e=>l(Number(e.size))},{title:D("Config.Backup.index_33"),key:"type"},R()]),{table:A,columns:E}=e([{title:D("Config.Backup.index_28"),key:"name"},{title:D("Config.Backup.index_29"),key:"size",render:e=>l(Number(e.size))},{title:D("Config.Backup.index_30"),key:"type"},R()]),{table:G,columns:J}=e([{title:D("Config.Backup.index_34"),key:"name"},R()]),{table:K,columns:L}=e([{title:D("Config.Backup.index_35"),key:"name"},R()]),{table:W,columns:X}=e([{title:D("Config.Backup.index_36"),key:"name"},{title:D("Config.Backup.index_37"),key:"size",render:e=>l(Number(e.size))},R()]),{table:Y,columns:Z}=e([{title:D("Config.Backup.index_38"),key:"name"},{title:D("Config.Backup.index_39"),key:"size",render:e=>l(Number(e.size))},R()]),{table:Q,columns:U}=e([{title:D("Config.Backup.index_40"),key:"type"},{title:D("Config.Backup.index_41"),key:"name"},{title:D("Config.Backup.index_42"),key:"ps"},R()]),{table:V,columns:$}=e([{title:D("Config.Backup.index_43"),key:"name"},{title:D("Config.Backup.index_44"),key:"value"},R()]),{table:ee,columns:ae}=e([{title:D("Config.Backup.index_45"),key:"name"},{title:D("Config.Backup.index_46"),key:"size",render:e=>l(Number(e.size))},R()]),{table:se,columns:te}=e([{title:D("Config.Backup.index_47"),key:"name"},{title:D("Config.Backup.index_48"),key:"version"},{title:D("Config.Backup.index_37"),key:"size",render:e=>l(Number(e.size))},R()]);export{X as A,q as B,S as C,N as D,M as E,f as F,B as G,w as H,v as I,y as J,b as K,H as a,O as b,I as c,C as d,T as e,E as f,k as g,G as h,x as i,J as j,L as k,Z as l,Q as m,U as n,V as o,$ as p,ee as q,ae as r,F as s,K as t,h as u,Y as v,A as w,se as x,te as y,W as z};
